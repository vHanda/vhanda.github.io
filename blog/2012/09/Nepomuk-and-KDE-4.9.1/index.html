<!doctype html><html dir=ltr lang=en data-theme class=html><head><title>Vishesh Handa
|
Nepomuk and KDE 4.9.1</title><meta charset=utf-8><meta name=generator content="Hugo 0.96.0"><meta name=viewport content="width=device-width,initial-scale=1,viewport-fit=cover"><meta name=author content="Vishesh Handa"><meta name=description content="
      


    "><link rel=stylesheet href=/scss/main.min.5259d55db7b9c675f751f0865411bd84a410f3ffcb5105b8fc00b22fcb739309.css integrity="sha256-UlnVXbe5xnX3UfCGVBG9hKQQ8//LUQW4/ACyL8tzkwk=" crossorigin=anonymous type=text/css><link rel=stylesheet href=/css/markupHighlight.min.31b0a1f317f55c529a460897848c97436bb138b19c399b37de70d463a8bf6ed5.css integrity="sha256-MbCh8xf1XFKaRgiXhIyXQ2uxOLGcOZs33nDUY6i/btU=" crossorigin=anonymous type=text/css><link rel=stylesheet href=/fontawesome/css/fontawesome.min.69685904d5c2a0c6258d03c207b778c10466edf6cea928cc0164c376b0ad0930.css integrity="sha256-aWhZBNXCoMYljQPCB7d4wQRm7fbOqSjMAWTDdrCtCTA=" crossorigin=anonymous type=text/css><link rel=stylesheet href=/fontawesome/css/solid.min.6d585e78d28cce1200d39fb133c92ed83df01738da721d0f48fb6eac62d24e04.css integrity="sha256-bVheeNKMzhIA05+xM8ku2D3wFzjach0PSPturGLSTgQ=" crossorigin=anonymous type=text/css><link rel=stylesheet href=/fontawesome/css/brands.min.6b00d96498d59caa0dbcf9b49d30d821915291f2ceb0e19248523c8607ff43fa.css integrity="sha256-awDZZJjVnKoNvPm0nTDYIZFSkfLOsOGSSFI8hgf/Q/o=" crossorigin=anonymous type=text/css><link rel="shortcut icon" href=/favicon.ico type=image/x-icon><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=canonical href=http://vhanda.in/blog/2012/09/Nepomuk-and-KDE-4.9.1/><script type=text/javascript src=/js/anatole-header.min.f9132794301a01ff16550ed66763482bd848f62243d278f5e550229a158bfd32.js integrity="sha256-+RMnlDAaAf8WVQ7WZ2NIK9hI9iJD0nj15VAimhWL/TI=" crossorigin=anonymous></script>
<script type=text/javascript src=/js/anatole-theme-switcher.min.560a26330d27ff44a44e83b53cd07a95d4230a65930d31c5c76a8d481e5b35bf.js integrity="sha256-VgomMw0n/0SkToO1PNB6ldQjCmWTDTHFx2qNSB5bNb8=" crossorigin=anonymous></script><meta name=twitter:card content="summary"><meta name=twitter:title content="Nepomuk and KDE 4.9.1"><meta name=twitter:description content="Last week 4.9.1 was tagged, and it should release any day now. A large part of my time was spent bug fixing and stabilizing some of the most user visible features. This blog post highlights some of the more user visible changes.
File Watcher Apart from minor fixes such as extra checks for buffer overflows, and kernel version checks, we have two major improvements:
Memory Leak The Nepomuk File monitoring service had a serious memory leak in 4."><meta property="og:title" content="Nepomuk and KDE 4.9.1"><meta property="og:description" content="Last week 4.9.1 was tagged, and it should release any day now. A large part of my time was spent bug fixing and stabilizing some of the most user visible features. This blog post highlights some of the more user visible changes.
File Watcher Apart from minor fixes such as extra checks for buffer overflows, and kernel version checks, we have two major improvements:
Memory Leak The Nepomuk File monitoring service had a serious memory leak in 4."><meta property="og:type" content="article"><meta property="og:url" content="http://vhanda.in/blog/2012/09/Nepomuk-and-KDE-4.9.1/"><meta property="article:section" content="blog"><meta property="article:published_time" content="2012-09-03T13:36:55+00:00"><meta property="article:modified_time" content="2012-09-03T13:36:55+00:00"><meta property="og:site_name" content="Vishesh Handa"><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","articleSection":"blog","name":"Nepomuk and KDE 4.9.1","headline":"Nepomuk and KDE 4.9.1","alternativeHeadline":"","description":"
      
        Last week 4.9.1 was tagged, and it should release any day now. A large part of my time was spent bug fixing and stabilizing some of the most user visible features. This blog post highlights some of the more user visible changes.\nFile Watcher Apart from minor fixes such as extra checks for buffer overflows, and kernel version checks, we have two major improvements:\nMemory Leak The Nepomuk File monitoring service had a serious memory leak in 4.


      


    ","inLanguage":"en-us","isFamilyFriendly":"true","mainEntityOfPage":{"@type":"WebPage","@id":"http:\/\/vhanda.in\/blog\/2012\/09\/Nepomuk-and-KDE-4.9.1\/"},"author":{"@type":"Person","name":"Vishesh Handa"},"creator":{"@type":"Person","name":"Vishesh Handa"},"accountablePerson":{"@type":"Person","name":"Vishesh Handa"},"copyrightHolder":{"@type":"Person","name":"Vishesh Handa"},"copyrightYear":"2012","dateCreated":"2012-09-03T13:36:55.00Z","datePublished":"2012-09-03T13:36:55.00Z","dateModified":"2012-09-03T13:36:55.00Z","publisher":{"@type":"Organization","name":"Vishesh Handa","url":"http://vhanda.in","logo":{"@type":"ImageObject","url":"http:\/\/vhanda.infavicon-32x32.png","width":"32","height":"32"}},"image":[],"url":"http:\/\/vhanda.in\/blog\/2012\/09\/Nepomuk-and-KDE-4.9.1\/","wordCount":"850","genre":[],"keywords":["planetkde","nepomuk"]}</script></head><body class="body theme--light"><div class=wrapper><aside class=wrapper__sidebar><div class="sidebar
animated fadeInDown"><div class=sidebar__content><div class=sidebar__introduction><img class=sidebar__introduction-profileimage src=/images/profile.jpg alt="profile picture"><h1 class=sidebar__introduction-title><a href=/>Vishesh Handa</a></h1><div class=sidebar__introduction-description><p></p></div></div><ul class=sidebar__list><li class=sidebar__list-item><a href=https://www.linkedin.com/in/visheshhanda/ rel=me aria-label=Linkedin title=Linkedin><i class="fab fa-linkedin fa-2x" aria-hidden=true></i></a></li><li class=sidebar__list-item><a href=https://github.com/vhanda rel=me aria-label=GitHub title=GitHub><i class="fab fa-github fa-2x" aria-hidden=true></i></a></li><li class=sidebar__list-item><a href=https://twitter.com/visheshhanda rel=me aria-label=Twitter title=Twitter><i class="fab fa-twitter fa-2x" aria-hidden=true></i></a></li><li class=sidebar__list-item><a href=mailto:me@vhanda.in rel=me aria-label=e-mail title=e-mail><i class="fas fa-envelope fa-2x" aria-hidden=true></i></a></li></ul></div><footer class="footer footer__sidebar"><ul class=footer__list><li class=footer__item>&copy;
Vishesh Handa
2022</li></ul></footer><script type=text/javascript src=/js/medium-zoom.min.a3fd0638ada4e3cec287e49a604b4a828cfef33a669afe60b96575761fff5cf3.js integrity="sha256-o/0GOK2k487Ch+SaYEtKgoz+8zpmmv5guWV1dh//XPM=" crossorigin=anonymous></script></div></aside><main class=wrapper__main><header class=header><div class="animated fadeInDown"><a role=button class=navbar-burger data-target=navMenu aria-label=menu aria-expanded=false><span aria-hidden=true class=navbar-burger__line></span>
<span aria-hidden=true class=navbar-burger__line></span>
<span aria-hidden=true class=navbar-burger__line></span></a><nav class=nav><ul class=nav__list id=navMenu></ul><ul class="nav__list nav__list--end"><li class=nav__list-item><div class=themeswitch><a title="Switch Theme"><i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></li></ul></nav></div></header><div class="post
animated fadeInDown"><div class=post__content><h1>Nepomuk and KDE 4.9.1</h1><p>Last week 4.9.1 was tagged, and it should release any day now. A large
part of my time was spent bug fixing and stabilizing some of the most
user visible features. This blog post highlights some of the more user
visible changes.</p><h1 id=file-watcher>File Watcher</h1><p>Apart from minor fixes such as extra checks for <a href=https://projects.kde.org/projects/kde/kdelibs/nepomuk-core/repository/revisions/5609c4cdd8c7d938a9b3e99285b1044eea2fcf04>buffer overflows</a>,
and kernel <a href=https://projects.kde.org/projects/kde/kdelibs/nepomuk-core/repository/revisions/55761d35bb9e9ce863797b742c301d947dab61d0>version checks</a>, we have two major improvements:</p><h2 id=memory-leak>Memory Leak</h2><p>The Nepomuk File monitoring service had a <a href="https://bugs.kde.org/show_bug.cgi?id=304476">serious memory leak</a> in
4.9.0, which was unfortunately not caught in the beta or RC testing
period. Depending on the number of directories present, the file watcher
service would <strong>consume a good 2 GB of your RAM</strong>. Fortunately, many
distributions patched their own tarballs before releasing to the public.</p><h2 id=reindexing-events>Reindexing events</h2><p>Another bug was that lots of files were being unnecessarily reindexed
when they were opened in write mode even though no changes had been
made. With 4.9.1 we actually <a href=https://projects.kde.org/projects/kde/kdelibs/nepomuk-core/repository/revisions/48d909c8aa4baca11e7bc1cf4ba5a23c1474fc22>check</a> if the modification time of the
file has changed, even when the file notification system tells us
otherwise.</p><p>This should fix most of the problems of files unnecessarily being
reindexed.</p><h1 id=file-indexer>File Indexer</h1><p>The File Indexer has also gone through a number of fixes -</p><h2 id=do-not-check-for-new-files-on-startup>Do not check for new files on startup</h2><p>One of the most annoying things I found about file indexing was the
initial check for new files on startup. Even though this check runs
silently in the background, it was very annoying. Specially for people
who run Nepomuk all the time.</p><p><img src=/blog/images/2012/09/03/scanning.png alt=image></p><p><a href=https://projects.kde.org/projects/kde/kdelibs/nepomuk-core/repository/revisions/150a55d5eaabd8ad9a97112214fc2e008e9a1d11>Now</a>, we only check if the strigi version has changed, and only then
do we check for new files / check for any files that could not be
indexed the last time. If someone wants to forcibly check for new files,
they can do so with a dbus call -</p><p><code>$ qdbus org.kde.nepomuk.services.nepomukfileindexer /nepomukfileindexer updateAllFolders false</code></p><p>Or wait till 4.10, when I add an option to do so in the KCM.</p><h2 id=secondary-indexer>Secondary Indexer</h2><p>This patch technically made it into 4.9.0, but I never got the chance to
blog about it. I&rsquo;ve introduced a <a href=https://projects.kde.org/projects/kde/kdelibs/nepomuk-core/repository/revisions/414fd4c1c3c358aab70e1e10dd726ea2c1432e1f>SimpleIndexer</a> which serves as
backup when the strigi indexers provide incorrect data. This way instead
of having no data about the file we at least have the basic information
such as filename, url and mimtype. I have plans for a more concrete
solution for 4.10, but that&rsquo;s for another blog post.</p><h2 id=nasty-deadlock>Nasty Deadlock</h2><p>Another <a href="https://bugs.kde.org/show_bug.cgi?id=304982">annoying bug</a> that was not caught with 4.9.0 was a deadlock
that rendered the file indexer service useless.</p><p><img src=/blog/images/2012/09/03/nepomuk-deadlock.jpg alt=image></p><p>This only happened during the first run of Nepomuk, and led to some
<a href=http://www.dedoimedo.com/computers/fedora-17-kde.html>unfortunate publicity</a>. In in the end it was a very simple fix once
the proper backtrace had been provided.</p><h2 id=strigi-analyzers>Strigi Analyzers</h2><p>Another big change which probably has a large impact on indexing times
is the blacklisting of certain file indexing (strigi) plugins. Currently
by default, we only <a href="https://bugs.kde.org/show_bug.cgi?id=303670">blacklist the SHA1 hash generator</a>. With it
blacklisted, we do not (hopefully) need to read the full contents of the
file. This results in a noticeable performance improvement for large
files.</p><h1 id=queries>Queries</h1><h2 id=file-queries>File Queries</h2><p><img src=/blog/images/2012/09/03/dolphin_places_panel.png alt=image></p><p>One of my favorite features of Dolphin is their Places Panel with all of
those defaults - Documents, Images, Audio and Video files.
Unfortunately, those defaults were normal Nepomuk queries and not file
queries. With 4.9.1, they have been changed to file queries which lets
them access a number of optimizations on our end, and allows them to
benefit from my <a href=https://projects.kde.org/projects/kde/kdelibs/nepomuk-core/repository/revisions/328fbfd8a6fc66bf0b10bda7813b4827e3118d72>minor optimizations</a> in file queries.</p><h2 id=query-updates>Query Updates</h2><p>Most applications which currently use Nepomuk utilize the QueryService
in order to run queries. The Query Service can then provide updates on
those queries if there is some change in the results - It used to do so
by running <strong>ALL open queries when any data in Nepomuk changes</strong>. This
was not a good approach, as it obviously does not scale.</p><p>With 4.9.1, we are now using <a href=https://projects.kde.org/projects/kde/kdelibs/nepomuk-core/repository/revisions/ead226c9571a15da8d7a92810f5c4afd35bf9de8>some simple heuristics</a> and the Resource
Watcher to only re-run queries when affected data changes. So indexing a
file will not result in the updating of all custom Nepomuk magic
folders.</p><h1 id=nepomuk-core-library>Nepomuk Core Library</h1><p>And finally, the have been a number of <a href=https://projects.kde.org/projects/kde/kdelibs/nepomuk-core/repository/revisions/e4d8cd1f76192dc798f2db09b9e19310d7c1d65f>bug fixes</a> and <a href=https://projects.kde.org/projects/kde/kdelibs/nepomuk-core/repository/revisions/7bef7c53d3b9a971c203ed4391bf19ac79f381f5>crash fixes</a>
in the NepomukCore library, but considering that they aren&rsquo;t really that
user visible, I&rsquo;m not going to talk much about them.</p><h1 id=miscellaneous>Miscellaneous</h1><p>There have been a large number of improvements in the Nepomuk Testing
Suite, and more tests have been added. Most of the tests passed, but it
still serves as a good way of checking regressions.</p><p>Along with that there have been some <a href=https://projects.kde.org/projects/kde/kdelibs/nepomuk-core/repository/revisions/24caa3821aed71e590a3e55a76c6e4bc08f7d9d5>fixes</a> with Removeable Media
handling.</p><h1 id=soprano>Soprano</h1><p>Recently I blogged about certain major query optimizations, which would
only be public in 4.10. This major optimization was done by skipping a
large part of the Soprano code. After the blog post, we identified some
of the bottle necks, and optimized them. The most impressive result was
a reduction of one query from <strong>6 seconds to 1 second</strong>.</p><p>Again, this isn&rsquo;t really a part of KDE 4.9.1, but it will be a part of
Soprano 2.8.1. So when it releases, make sure you upgrade.</p><p>That&rsquo;s all for this release :)</p></div><div class=post__footer><span><a class=tag href=/tags/planetkde/>planetkde</a><a class=tag href=/tags/nepomuk/>nepomuk</a></span></div></div></main></div><footer class="footer footer__base"><ul class=footer__list><li class=footer__item>&copy;
Vishesh Handa
2022</li></ul></footer><script type=text/javascript src=/js/medium-zoom.min.a3fd0638ada4e3cec287e49a604b4a828cfef33a669afe60b96575761fff5cf3.js integrity="sha256-o/0GOK2k487Ch+SaYEtKgoz+8zpmmv5guWV1dh//XPM=" crossorigin=anonymous></script></body></html>