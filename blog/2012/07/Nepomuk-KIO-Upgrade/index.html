<!doctype html><html dir=ltr lang=en data-theme class=html><head><title>Vishesh Handa
|
Nepomuk KIO Upgrade</title><meta charset=utf-8><meta name=generator content="Hugo 0.96.0"><meta name=viewport content="width=device-width,initial-scale=1,viewport-fit=cover"><meta name=author content="Vishesh Handa"><meta name=description content="
      Haven't figured out a description


    "><link rel=stylesheet href=/scss/main.min.5259d55db7b9c675f751f0865411bd84a410f3ffcb5105b8fc00b22fcb739309.css integrity="sha256-UlnVXbe5xnX3UfCGVBG9hKQQ8//LUQW4/ACyL8tzkwk=" crossorigin=anonymous type=text/css><link rel=stylesheet href=/css/markupHighlight.min.31b0a1f317f55c529a460897848c97436bb138b19c399b37de70d463a8bf6ed5.css integrity="sha256-MbCh8xf1XFKaRgiXhIyXQ2uxOLGcOZs33nDUY6i/btU=" crossorigin=anonymous type=text/css><link rel=stylesheet href=/fontawesome/css/fontawesome.min.69685904d5c2a0c6258d03c207b778c10466edf6cea928cc0164c376b0ad0930.css integrity="sha256-aWhZBNXCoMYljQPCB7d4wQRm7fbOqSjMAWTDdrCtCTA=" crossorigin=anonymous type=text/css><link rel=stylesheet href=/fontawesome/css/solid.min.6d585e78d28cce1200d39fb133c92ed83df01738da721d0f48fb6eac62d24e04.css integrity="sha256-bVheeNKMzhIA05+xM8ku2D3wFzjach0PSPturGLSTgQ=" crossorigin=anonymous type=text/css><link rel=stylesheet href=/fontawesome/css/brands.min.6b00d96498d59caa0dbcf9b49d30d821915291f2ceb0e19248523c8607ff43fa.css integrity="sha256-awDZZJjVnKoNvPm0nTDYIZFSkfLOsOGSSFI8hgf/Q/o=" crossorigin=anonymous type=text/css><link rel="shortcut icon" href=/favicon.ico type=image/x-icon><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=canonical href=http://vhanda.in/blog/2012/07/Nepomuk-KIO-Upgrade/><script type=text/javascript src=/js/anatole-header.min.f9132794301a01ff16550ed66763482bd848f62243d278f5e550229a158bfd32.js integrity="sha256-+RMnlDAaAf8WVQ7WZ2NIK9hI9iJD0nj15VAimhWL/TI=" crossorigin=anonymous></script>
<script type=text/javascript src=/js/anatole-theme-switcher.min.560a26330d27ff44a44e83b53cd07a95d4230a65930d31c5c76a8d481e5b35bf.js integrity="sha256-VgomMw0n/0SkToO1PNB6ldQjCmWTDTHFx2qNSB5bNb8=" crossorigin=anonymous></script><meta name=twitter:card content="summary"><meta name=twitter:title content="Nepomuk KIO Upgrade"><meta name=twitter:description content="In case you haven&rsquo;t been running trunk, or haven&rsquo;t tried out the latest release candidates (you really should), you should know that dolphin has had a lot of major improvements since the last release. One of the features I really love is better Nepomuk integration. This enhanced user visibility lands up exposing bottlenecks, and performance problems. That&rsquo;s exactly what happened with the nepomuk search kio slave.
Dolphin exposes this neat sidebar which allows users to list out the different kind of files - Documents, Images, Audio and Videos."><meta property="og:title" content="Nepomuk KIO Upgrade"><meta property="og:description" content="In case you haven&rsquo;t been running trunk, or haven&rsquo;t tried out the latest release candidates (you really should), you should know that dolphin has had a lot of major improvements since the last release. One of the features I really love is better Nepomuk integration. This enhanced user visibility lands up exposing bottlenecks, and performance problems. That&rsquo;s exactly what happened with the nepomuk search kio slave.
Dolphin exposes this neat sidebar which allows users to list out the different kind of files - Documents, Images, Audio and Videos."><meta property="og:type" content="article"><meta property="og:url" content="http://vhanda.in/blog/2012/07/Nepomuk-KIO-Upgrade/"><meta property="article:section" content="blog"><meta property="article:published_time" content="2012-07-10T19:16:43+00:00"><meta property="article:modified_time" content="2012-07-10T19:16:43+00:00"><meta property="og:site_name" content="Vishesh Handa"><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","articleSection":"blog","name":"Nepomuk KIO Upgrade","headline":"Nepomuk KIO Upgrade","alternativeHeadline":"","description":"
      
        In case you haven\u0026rsquo;t been running trunk, or haven\u0026rsquo;t tried out the latest release candidates (you really should), you should know that dolphin has had a lot of major improvements since the last release. One of the features I really love is better Nepomuk integration. This enhanced user visibility lands up exposing bottlenecks, and performance problems. That\u0026rsquo;s exactly what happened with the nepomuk search kio slave.\nDolphin exposes this neat sidebar which allows users to list out the different kind of files - Documents, Images, Audio and Videos.


      


    ","inLanguage":"en-us","isFamilyFriendly":"true","mainEntityOfPage":{"@type":"WebPage","@id":"http:\/\/vhanda.in\/blog\/2012\/07\/Nepomuk-KIO-Upgrade\/"},"author":{"@type":"Person","name":"Vishesh Handa"},"creator":{"@type":"Person","name":"Vishesh Handa"},"accountablePerson":{"@type":"Person","name":"Vishesh Handa"},"copyrightHolder":{"@type":"Person","name":"Vishesh Handa"},"copyrightYear":"2012","dateCreated":"2012-07-10T19:16:43.00Z","datePublished":"2012-07-10T19:16:43.00Z","dateModified":"2012-07-10T19:16:43.00Z","publisher":{"@type":"Organization","name":"Vishesh Handa","url":"http://vhanda.in","logo":{"@type":"ImageObject","url":"http:\/\/vhanda.infavicon-32x32.png","width":"32","height":"32"}},"image":[],"url":"http:\/\/vhanda.in\/blog\/2012\/07\/Nepomuk-KIO-Upgrade\/","wordCount":"343","genre":[],"keywords":["planetkde","nepomuk"]}</script></head><body class="body theme--light"><div class=wrapper><aside class=wrapper__sidebar><div class="sidebar
animated fadeInDown"><div class=sidebar__content><div class=sidebar__introduction><img class=sidebar__introduction-profileimage src=/images/profile.jpg alt="profile picture"><h1 class=sidebar__introduction-title><a href=/>Vishesh Handa</a></h1><div class=sidebar__introduction-description><p>Haven't figured out a description</p></div></div><ul class=sidebar__list><li class=sidebar__list-item><a href=https://www.linkedin.com/in/visheshhanda/ rel=me aria-label=Linkedin title=Linkedin><i class="fab fa-linkedin fa-2x" aria-hidden=true></i></a></li><li class=sidebar__list-item><a href=https://github.com/vhanda rel=me aria-label=GitHub title=GitHub><i class="fab fa-github fa-2x" aria-hidden=true></i></a></li><li class=sidebar__list-item><a href=https://twitter.com/visheshhanda rel=me aria-label=Twitter title=Twitter><i class="fab fa-twitter fa-2x" aria-hidden=true></i></a></li><li class=sidebar__list-item><a href=mailto:me@vhanda.in rel=me aria-label=e-mail title=e-mail><i class="fas fa-envelope fa-2x" aria-hidden=true></i></a></li></ul></div><footer class="footer footer__sidebar"><ul class=footer__list><li class=footer__item>&copy;
Vishesh Handa
2022</li></ul></footer><script type=text/javascript src=/js/medium-zoom.min.a3fd0638ada4e3cec287e49a604b4a828cfef33a669afe60b96575761fff5cf3.js integrity="sha256-o/0GOK2k487Ch+SaYEtKgoz+8zpmmv5guWV1dh//XPM=" crossorigin=anonymous></script></div></aside><main class=wrapper__main><header class=header><div class="animated fadeInDown"><a role=button class=navbar-burger data-target=navMenu aria-label=menu aria-expanded=false><span aria-hidden=true class=navbar-burger__line></span>
<span aria-hidden=true class=navbar-burger__line></span>
<span aria-hidden=true class=navbar-burger__line></span></a><nav class=nav><ul class=nav__list id=navMenu></ul><ul class="nav__list nav__list--end"><li class=nav__list-item><div class=themeswitch><a title="Switch Theme"><i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></li></ul></nav></div></header><div class="post
animated fadeInDown"><div class=post__content><h1>Nepomuk KIO Upgrade</h1><p>In case you haven&rsquo;t been running trunk, or haven&rsquo;t tried out the latest
release candidates (you really should), you should know that dolphin has
had a lot of major improvements since the last release. One of the
features I really love is better Nepomuk integration. This enhanced user
visibility lands up exposing bottlenecks, and performance problems.
That&rsquo;s exactly what happened with the nepomuk search kio slave.</p><p><img src=/blog/images/2012/07/10/dolphin_sidebar.png alt="The Nepomuk Architecture"></p><p>Dolphin exposes this neat sidebar which allows users to list out the
different kind of files - Documents, Images, Audio and Videos. A little
more than a month ago, I tried it out and was quite disappointed with
both the performance and the results. It was quite normal for dolphin to
popup a message saying that &rsquo;nepomuksearch&rsquo; kio-slave had crashed.</p><p>Needless to say, RC2 fixes most of the issues and the performance is
quite good.</p><h1 id=the-original-architecture>The Original Architecture</h1><p><img src=/blog/images/2012/07/10/Nepomuk_KIO_old_Architecture.png alt="The Nepomuk Architecture"></p><h2 id=step-1---remove-threading>Step 1 - Remove threading</h2><p>If you look closely you can see the large number of useless threads that
are spawned in the process of one query. The kioslave spawns a separate
thread in the kio_nepomuksearch process, and then the <em>Query Service</em>
spawns another thread on which it actually runs the query and send the
results back via dbus.</p><p>The thread of the nepomuk kioslave is just running an event loop waiting
for it to get the results over DBus. This is especially useless, cause
kioslaves can be blocking.</p><h2 id=step-2---skip-the-middle-man>Step 2 - Skip the middle man</h2><p>The second big bottle neck is the transmission of the query results over
DBus via the queryservice, and the extra thread that is spawned cause of
that. You might just ask - &ldquo;What the point of the query service
anyway?&rdquo;. Well it exists to cache query results and to provide query
updates, so it isn&rsquo;t a complete waste.</p><p>However, the extra overhead didn&rsquo;t seem worth it.</p><h1 id=the-current-architecture>The Current Architecture</h1><p><img src=/blog/images/2012/07/10/Nepomuk_KIO_new_Architecture.png alt="The Nepomuk Architecture"></p><p>The extra threading has been removed from the kioslave, and it now
directly communicates with the storage service to run the queries. It
seems a lot cleaner this way, and is a lot faster.</p></div><div class=post__footer><span><a class=tag href=/tags/planetkde/>planetkde</a><a class=tag href=/tags/nepomuk/>nepomuk</a></span></div></div></main></div><footer class="footer footer__base"><ul class=footer__list><li class=footer__item>&copy;
Vishesh Handa
2022</li></ul></footer><script type=text/javascript src=/js/medium-zoom.min.a3fd0638ada4e3cec287e49a604b4a828cfef33a669afe60b96575761fff5cf3.js integrity="sha256-o/0GOK2k487Ch+SaYEtKgoz+8zpmmv5guWV1dh//XPM=" crossorigin=anonymous></script></body></html>