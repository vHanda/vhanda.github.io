<!doctype html><html dir=ltr lang=en data-theme class=html><head><title>Vishesh Handa
|
Merging Nepomuk Graphs</title><meta charset=utf-8><meta name=generator content="Hugo 0.95.0"><meta name=viewport content="width=device-width,initial-scale=1,viewport-fit=cover"><meta name=author content="Vishesh Handa"><meta name=description content="
      Haven't figured out a description


    "><link rel=stylesheet href=/scss/main.min.5259d55db7b9c675f751f0865411bd84a410f3ffcb5105b8fc00b22fcb739309.css integrity="sha256-UlnVXbe5xnX3UfCGVBG9hKQQ8//LUQW4/ACyL8tzkwk=" crossorigin=anonymous type=text/css><link rel=stylesheet href=/css/markupHighlight.min.31b0a1f317f55c529a460897848c97436bb138b19c399b37de70d463a8bf6ed5.css integrity="sha256-MbCh8xf1XFKaRgiXhIyXQ2uxOLGcOZs33nDUY6i/btU=" crossorigin=anonymous type=text/css><link rel=stylesheet href=/fontawesome/css/fontawesome.min.69685904d5c2a0c6258d03c207b778c10466edf6cea928cc0164c376b0ad0930.css integrity="sha256-aWhZBNXCoMYljQPCB7d4wQRm7fbOqSjMAWTDdrCtCTA=" crossorigin=anonymous type=text/css><link rel=stylesheet href=/fontawesome/css/solid.min.6d585e78d28cce1200d39fb133c92ed83df01738da721d0f48fb6eac62d24e04.css integrity="sha256-bVheeNKMzhIA05+xM8ku2D3wFzjach0PSPturGLSTgQ=" crossorigin=anonymous type=text/css><link rel=stylesheet href=/fontawesome/css/brands.min.6b00d96498d59caa0dbcf9b49d30d821915291f2ceb0e19248523c8607ff43fa.css integrity="sha256-awDZZJjVnKoNvPm0nTDYIZFSkfLOsOGSSFI8hgf/Q/o=" crossorigin=anonymous type=text/css><link rel="shortcut icon" href=/favicon.ico type=image/x-icon><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=canonical href=http://vhanda.in/blog/2013/04/Merging-Nepomuk-Graphs/><script type=text/javascript src=/js/anatole-header.min.f9132794301a01ff16550ed66763482bd848f62243d278f5e550229a158bfd32.js integrity="sha256-+RMnlDAaAf8WVQ7WZ2NIK9hI9iJD0nj15VAimhWL/TI=" crossorigin=anonymous></script>
<script type=text/javascript src=/js/anatole-theme-switcher.min.560a26330d27ff44a44e83b53cd07a95d4230a65930d31c5c76a8d481e5b35bf.js integrity="sha256-VgomMw0n/0SkToO1PNB6ldQjCmWTDTHFx2qNSB5bNb8=" crossorigin=anonymous></script><meta name=twitter:card content="summary"><meta name=twitter:title content="Merging Nepomuk Graphs"><meta name=twitter:description content="Since I&rsquo;ve become the maintainer of Nepomuk we have put a strong emphasis on performance and stability. One of the core parts of Nepomuk are the high level operations that are exposed to the applications. These operations are typically used to insert and modify data into Nepomuk. Each of these operations is quite complex and involves a number of complicated queries.
For this 4.11 release we wanted to simplify that code and make it more efficient."><meta property="og:title" content="Merging Nepomuk Graphs"><meta property="og:description" content="Since I&rsquo;ve become the maintainer of Nepomuk we have put a strong emphasis on performance and stability. One of the core parts of Nepomuk are the high level operations that are exposed to the applications. These operations are typically used to insert and modify data into Nepomuk. Each of these operations is quite complex and involves a number of complicated queries.
For this 4.11 release we wanted to simplify that code and make it more efficient."><meta property="og:type" content="article"><meta property="og:url" content="http://vhanda.in/blog/2013/04/Merging-Nepomuk-Graphs/"><meta property="article:section" content="blog"><meta property="article:published_time" content="2013-04-16T17:40:00+00:00"><meta property="article:modified_time" content="2013-04-16T17:40:00+00:00"><meta property="og:site_name" content="Vishesh Handa"><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","articleSection":"blog","name":"Merging Nepomuk Graphs","headline":"Merging Nepomuk Graphs","alternativeHeadline":"","description":"
      
        Since I\u0026rsquo;ve become the maintainer of Nepomuk we have put a strong emphasis on performance and stability. One of the core parts of Nepomuk are the high level operations that are exposed to the applications. These operations are typically used to insert and modify data into Nepomuk. Each of these operations is quite complex and involves a number of complicated queries.\nFor this 4.11 release we wanted to simplify that code and make it more efficient.


      


    ","inLanguage":"en-us","isFamilyFriendly":"true","mainEntityOfPage":{"@type":"WebPage","@id":"http:\/\/vhanda.in\/blog\/2013\/04\/Merging-Nepomuk-Graphs\/"},"author":{"@type":"Person","name":"Vishesh Handa"},"creator":{"@type":"Person","name":"Vishesh Handa"},"accountablePerson":{"@type":"Person","name":"Vishesh Handa"},"copyrightHolder":{"@type":"Person","name":"Vishesh Handa"},"copyrightYear":"2013","dateCreated":"2013-04-16T17:40:00.00Z","datePublished":"2013-04-16T17:40:00.00Z","dateModified":"2013-04-16T17:40:00.00Z","publisher":{"@type":"Organization","name":"Vishesh Handa","url":"http://vhanda.in","logo":{"@type":"ImageObject","url":"http:\/\/vhanda.infavicon-32x32.png","width":"32","height":"32"}},"image":[],"url":"http:\/\/vhanda.in\/blog\/2013\/04\/Merging-Nepomuk-Graphs\/","wordCount":"872","genre":[],"keywords":["planetkde","nepomuk"]}</script></head><body class="body theme--light"><div class=wrapper><aside class=wrapper__sidebar><div class="sidebar
animated fadeInDown"><div class=sidebar__content><div class=sidebar__introduction><img class=sidebar__introduction-profileimage src=/blog/images/2015/08/16/vhanda.jpg alt="profile picture"><h1 class=sidebar__introduction-title><a href=/>Vishesh Handa</a></h1><div class=sidebar__introduction-description><p>Haven't figured out a description</p></div></div><ul class=sidebar__list><li class=sidebar__list-item><a href=https://www.linkedin.com/in/visheshhanda/ rel=me aria-label=Linkedin title=Linkedin><i class="fab fa-linkedin fa-2x" aria-hidden=true></i></a></li><li class=sidebar__list-item><a href=https://github.com/vhanda rel=me aria-label=GitHub title=GitHub><i class="fab fa-github fa-2x" aria-hidden=true></i></a></li><li class=sidebar__list-item><a href=https://twitter.com/visheshhanda rel=me aria-label=Twitter title=Twitter><i class="fab fa-twitter fa-2x" aria-hidden=true></i></a></li><li class=sidebar__list-item><a href=mailto:me@vhanda.in rel=me aria-label=e-mail title=e-mail><i class="fas fa-envelope fa-2x" aria-hidden=true></i></a></li></ul></div><footer class="footer footer__sidebar"><ul class=footer__list><li class=footer__item>&copy;
Vishesh Handa
2022</li></ul></footer><script type=text/javascript src=/js/medium-zoom.min.a3fd0638ada4e3cec287e49a604b4a828cfef33a669afe60b96575761fff5cf3.js integrity="sha256-o/0GOK2k487Ch+SaYEtKgoz+8zpmmv5guWV1dh//XPM=" crossorigin=anonymous></script></div></aside><main class=wrapper__main><header class=header><div class="animated fadeInDown"><a role=button class=navbar-burger data-target=navMenu aria-label=menu aria-expanded=false><span aria-hidden=true class=navbar-burger__line></span>
<span aria-hidden=true class=navbar-burger__line></span>
<span aria-hidden=true class=navbar-burger__line></span></a><nav class=nav><ul class=nav__list id=navMenu></ul><ul class="nav__list nav__list--end"><li class=nav__list-item><div class=themeswitch><a title="Switch Theme"><i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></li></ul></nav></div></header><div class="post
animated fadeInDown"><div class=post__content><h1>Merging Nepomuk Graphs</h1><p>Since I&rsquo;ve become the maintainer of Nepomuk we have put a strong emphasis on performance and stability. One of the core parts of Nepomuk are the high level operations that are exposed to the applications. These operations are typically used to insert and modify data into Nepomuk. Each of these operations is quite complex and involves a number of complicated queries.</p><p>For this 4.11 release we wanted to simplify that code and make it more efficient. This blog post delves in the technical details of what has changed, and then finally goes into how that affects the users.</p><h1 id=graphs>Graphs</h1><p>It is often said that Nepomuk operates on triples in the format -</p><p><code>&lt;subject> &lt;predicate> &lt;object></code></p><p>While this is true, it skips over the fourth parameter which is the context or graph. Statements in Nepomuk are actually of the form -</p><p><code>&lt;subject> &lt;predicate> &lt;object> &lt;graph></code></p><p>This fourth parameter allows us to store some additional information about the statement such as when it was added and who added it. The Nepomuk project has had a history of saving a lot of data without a clear usecase in mind. Graphs are a prime example of that.</p><p>Each statement does not have its own graph, rather a group of statements are clubbed together in one graph.</p><p>Before the 4.8 release, a new graph was created every 200 msecs. This graph just contained the creation date of the graph. This involved the insertion of 4 statements -</p><pre tabindex=0><code>&lt;graph&gt; a nrl:InstanceBase .
&lt;graph&gt; nao:created “dateTime” .
&lt;metaDataGraph&gt; a nrl:GraphMetadata .
&lt;metaDataGraph&gt; nrl:coreGraphMetadataFor &lt;graph&gt; .
</code></pre><p>These 4 statements have never seen any use.</p><p>After the 4.8 release we introduced a set of central asynchronous APIs which performed a lot of the higher level functions so that application would not have to deal directly with statements.</p><p>This new API created a new graph each time a call was made to any of these higher level functions. The graphs that were now created were slightly more useful. They contained the following information</p><ul><li>creation date</li><li>creating agent</li></ul><p>The “Agent” in this case is the application that send the command for the data to be added. This extra “Agent” field allowed us some nice operations such as <code>removeDataByApplication</code> which allows applications to only remove the data they have added.</p><p>This functionality was already present for the file indexer in the pre-4.8 days. It was then generalized and made applicable to all applications.</p><p>The bottle neck is this plan is the creation of a new graph for each command. Even adding a simple property would result in a good 5-10 insert calls. This effectively kills our performance. For the 4.10 release I managed to combine a number of these insert calls and optimize the code, but we were still doing a large number of writes which served no purpose. We have never used the creation date of a graph in any way.</p><p>Additionally, we had to perform complex queries to make sure the data is always present in one graph, and check for empty graphs so that they could be removed. Overall, it was quite messy.</p><h1 id=new-graph-handling>New Graph Handling</h1><p>With this 4.11 release I have simplified the concept of graphs. Now there are a limited number of graphs based on the number of Agents that push data into Nepomuk. Each Agent gets its own graph. This way we can still easily implement ‘removeDataByApplication’, and decrease the complexity of our code base.</p><p>This grossly simplifies the internals of the Nepomuk code base since no longer need to worry about all the complicated graph handling.</p><p>This big change is still in a <code>feature/mergeGraphs</code> branch. I&rsquo;m still not completely ready to merge it into master.</p><h1 id=benchmarks>Benchmarks</h1><p>These are initial benchmarks that were taken about a month ago. There is still scope for more optimizations. Especially if we combine more of our SPARQL calls. Also these benchmarks were run on a blank database. The difference should be a <em>lot</em> larger when there is some real world data.</p><table><thead><tr><th style=text-align:left>Function</th><th style=text-align:right>4.9</th><th style=text-align:right>4.10</th><th style=text-align:right>4.11</th></tr></thead><tbody><tr><td style=text-align:left>addProperty()</td><td style=text-align:right>130</td><td style=text-align:right>79</td><td style=text-align:right>32</td></tr><tr><td style=text-align:left>addProperty_sameData()</td><td style=text-align:right>60</td><td style=text-align:right>34</td><td style=text-align:right>32</td></tr><tr><td style=text-align:left>setProperty()</td><td style=text-align:right>150</td><td style=text-align:right>107</td><td style=text-align:right>40</td></tr><tr><td style=text-align:left>setProperty_sameData()</td><td style=text-align:right>145</td><td style=text-align:right>94</td><td style=text-align:right>41</td></tr><tr><td style=text-align:left>storeResources()</td><td style=text-align:right>85</td><td style=text-align:right>52</td><td style=text-align:right>21</td></tr><tr><td style=text-align:left>storeResources_email()</td><td style=text-align:right>300</td><td style=text-align:right>85</td><td style=text-align:right>77</td></tr><tr><td style=text-align:left>createResource()</td><td style=text-align:right>26</td><td style=text-align:right>14</td><td style=text-align:right>8</td></tr><tr><td style=text-align:left>removeResources()</td><td style=text-align:right>49</td><td style=text-align:right>30</td><td style=text-align:right>16</td></tr><tr><td style=text-align:left>removeDataByApplication()</td><td style=text-align:right>82</td><td style=text-align:right>182</td><td style=text-align:right>54</td></tr><tr><td style=text-align:left>removeDataByApplication_subResources</td><td style=text-align:right>89</td><td style=text-align:right>171</td><td style=text-align:right>58</td></tr><tr><td style=text-align:left>removeAllDataByApplication()</td><td style=text-align:right>84</td><td style=text-align:right>375</td><td style=text-align:right>55</td></tr></tbody></table><p>The numbers are in msecs. The functions are the higher level functions that all applications use to push any data into Nepomuk.</p><p>Whenever you add a tag in Nepomuk, the addProperty/setProperty methods are called. The file indexers and PIM feeder mostly use the <code>storeResources</code> function to push new data and <code>removeDataByApplication</code> to remove existing indexing data.</p><p>If you look at the results you&rsquo;ll notice a substantial increase with 4.10 except for the <code>removeDataByApplication</code> functions where they seem to have taken a severe hit. I&rsquo;m not too sure why this has happened, the only change in that code base has been one bug fix which should have increased performance.</p><p>As noted above the number of graphs in Nepomuk are now limited and we no longer create superfluous graphs. However, all those extra graphs are still present and need to merged into a finite number. This can be a time consuming process.</p><p>Tomorrow, I&rsquo;ll go into the details of how we plan to counter that.</p></div><div class=post__footer><span><a class=tag href=/tags/planetkde/>planetkde</a><a class=tag href=/tags/nepomuk/>nepomuk</a></span></div></div></main></div><footer class="footer footer__base"><ul class=footer__list><li class=footer__item>&copy;
Vishesh Handa
2022</li></ul></footer><script type=text/javascript src=/js/medium-zoom.min.a3fd0638ada4e3cec287e49a604b4a828cfef33a669afe60b96575761fff5cf3.js integrity="sha256-o/0GOK2k487Ch+SaYEtKgoz+8zpmmv5guWV1dh//XPM=" crossorigin=anonymous></script></body></html>